<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Audio Conference Admin Panel</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
					sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				color: #333;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			.header {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(10px);
				border-radius: 15px;
				padding: 30px;
				margin-bottom: 30px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
			}

			.header h1 {
				font-size: 2.5rem;
				color: #667eea;
				margin-bottom: 10px;
				text-align: center;
			}

			.header p {
				text-align: center;
				color: #666;
				font-size: 1.1rem;
			}

			.connection-form {
				background: white;
				border-radius: 15px;
				padding: 30px;
				margin-bottom: 30px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #333;
			}

			.form-group input {
				width: 100%;
				padding: 12px 16px;
				border: 2px solid #e1e5e9;
				border-radius: 8px;
				font-size: 16px;
				transition: border-color 0.3s;
			}

			.form-group input:focus {
				outline: none;
				border-color: #667eea;
			}

			.btn {
				background: #667eea;
				color: white;
				border: none;
				padding: 12px 24px;
				border-radius: 8px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s;
			}

			.btn:hover {
				background: #5a6fd8;
				transform: translateY(-2px);
			}

			.btn:disabled {
				background: #ccc;
				cursor: not-allowed;
				transform: none;
			}

			.btn-approve {
				background: #48bb78;
			}

			.btn-approve:hover {
				background: #38a169;
			}

			.btn-reject {
				background: #e53e3e;
			}

			.btn-reject:hover {
				background: #c53030;
			}

			.btn-stop {
				background: #ed8936;
			}

			.btn-stop:hover {
				background: #dd7724;
			}

			.status-indicator {
				display: inline-block;
				width: 12px;
				height: 12px;
				border-radius: 50%;
				margin-right: 8px;
			}

			.status-connected {
				background: #48bb78;
			}

			.status-disconnected {
				background: #e53e3e;
			}

			.dashboard {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 30px;
				margin-bottom: 30px;
			}

			.card {
				background: white;
				border-radius: 15px;
				padding: 25px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
			}

			.card h3 {
				color: #667eea;
				margin-bottom: 20px;
				font-size: 1.4rem;
				border-bottom: 2px solid #f1f5f9;
				padding-bottom: 10px;
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}

			.stat-card {
				background: white;
				border-radius: 12px;
				padding: 20px;
				text-align: center;
				box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
			}

			.stat-number {
				font-size: 2rem;
				font-weight: bold;
				color: #667eea;
				margin-bottom: 5px;
			}

			.stat-label {
				color: #666;
				font-size: 0.9rem;
			}

			.queue-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 15px;
				background: #f8fafc;
				border-radius: 10px;
				margin-bottom: 10px;
				border-left: 4px solid #667eea;
			}

			.queue-info {
				flex: 1;
			}

			.queue-name {
				font-weight: 600;
				color: #333;
			}

			.queue-time {
				font-size: 0.85rem;
				color: #666;
			}

			.queue-actions {
				display: flex;
				gap: 10px;
			}

			.queue-actions button {
				padding: 6px 12px;
				font-size: 14px;
			}

			.user-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 12px;
				background: #f8fafc;
				border-radius: 8px;
				margin-bottom: 8px;
			}

			.user-info {
				flex: 1;
			}

			.user-name {
				font-weight: 500;
				color: #333;
			}

			.user-status {
				font-size: 0.8rem;
				color: #666;
			}

			.speaker-item {
				background: #e6fffa;
				border-left: 4px solid #38b2ac;
			}

			.empty-state {
				text-align: center;
				color: #666;
				font-style: italic;
				padding: 20px;
			}

			.hidden {
				display: none;
			}

			.logs {
				background: #1a202c;
				color: #e2e8f0;
				border-radius: 10px;
				padding: 20px;
				font-family: "Courier New", monospace;
				font-size: 14px;
				max-height: 300px;
				overflow-y: auto;
			}

			.log-entry {
				margin-bottom: 5px;
				padding: 2px 0;
			}

			.log-timestamp {
				color: #4a5568;
			}

			.performance-metrics {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 15px;
				margin-top: 20px;
			}

			.metric {
				background: #f7fafc;
				padding: 15px;
				border-radius: 8px;
				text-align: center;
			}

			.metric-value {
				font-size: 1.5rem;
				font-weight: bold;
				color: #667eea;
			}

			.metric-label {
				font-size: 0.8rem;
				color: #666;
				margin-top: 5px;
			}

			@media (max-width: 768px) {
				.dashboard {
					grid-template-columns: 1fr;
				}

				.stats-grid {
					grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>üéôÔ∏è Audio Conference Admin Panel</h1>
				<p>Manage speakers, approve requests, and monitor conference quality</p>
			</div>

			<!-- Connection Form -->
			<div class="connection-form" id="connectionForm">
				<div class="form-group">
					<label for="serverUrl">Conference Server URL:</label>
					<input
						type="text"
						id="serverUrl"
						placeholder="http://145.223.98.156:3000"
						value="http://145.223.98.156:3000"
					/>
				</div>
				<div class="form-group">
					<label for="adminName">Admin Name:</label>
					<input
						type="text"
						id="adminName"
						placeholder="Enter your name"
						value="Admin"
					/>
				</div>
				<button class="btn" id="connectBtn" onclick="connectToServer()">
					Connect as Admin
				</button>
			</div>

			<!-- Dashboard -->
			<div id="dashboard" class="hidden">
				<!-- Statistics -->
				<div class="stats-grid">
					<div class="stat-card">
						<div class="stat-number" id="totalUsers">0</div>
						<div class="stat-label">Total Users</div>
					</div>
					<div class="stat-card">
						<div class="stat-number" id="activeSpeakers">0</div>
						<div class="stat-label">Active Speakers</div>
					</div>
					<div class="stat-card">
						<div class="stat-number" id="queueLength">0</div>
						<div class="stat-label">Queue Length</div>
					</div>
					<div class="stat-card">
						<div class="stat-number" id="avgLatency">0ms</div>
						<div class="stat-label">Avg Latency</div>
					</div>
				</div>

				<div class="dashboard">
					<!-- Speaking Queue -->
					<div class="card">
						<h3>üé§ Speaking Queue</h3>
						<div id="queueList">
							<div class="empty-state">No pending requests</div>
						</div>
					</div>

					<!-- Active Speakers -->
					<div class="card">
						<h3>üó£Ô∏è Active Speakers</h3>
						<div id="speakersList">
							<div class="empty-state">No one is speaking</div>
						</div>
					</div>
				</div>

				<!-- All Users -->
				<div class="card">
					<h3>üë• All Connected Users</h3>
					<div id="usersList">
						<div class="empty-state">No users connected</div>
					</div>
				</div>

				<!-- Performance Metrics -->
				<div class="card">
					<h3>üìä Performance Metrics</h3>
					<div class="performance-metrics">
						<div class="metric">
							<div class="metric-value" id="packetsProcessed">0</div>
							<div class="metric-label">Packets Processed</div>
						</div>
						<div class="metric">
							<div class="metric-value" id="uptime">0s</div>
							<div class="metric-label">Server Uptime</div>
						</div>
						<div class="metric">
							<div class="metric-value" id="memoryUsage">0MB</div>
							<div class="metric-label">Memory Usage</div>
						</div>
					</div>
				</div>

				<!-- Activity Logs -->
				<div class="card">
					<h3>üìù Activity Logs</h3>
					<div class="logs" id="activityLogs">
						<div class="log-entry">
							<span class="log-timestamp">[Ready]</span> Admin panel loaded
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			let socket = null;
			let isConnected = false;
			let users = new Map();
			let speakers = new Map();
			let queue = [];

			function addLog(message) {
				const logs = document.getElementById("activityLogs");
				const timestamp = new Date().toLocaleTimeString();
				const logEntry = document.createElement("div");
				logEntry.className = "log-entry";
				logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${message}`;
				logs.appendChild(logEntry);
				logs.scrollTop = logs.scrollHeight;
			}

			function connectToServer() {
				const serverUrl = document.getElementById("serverUrl").value.trim();
				const adminName = document.getElementById("adminName").value.trim();

				if (!serverUrl || !adminName) {
					alert("Please enter server URL and admin name");
					return;
				}

				const connectBtn = document.getElementById("connectBtn");
				connectBtn.disabled = true;
				connectBtn.textContent = "Connecting...";

				addLog(`Connecting to ${serverUrl} as ${adminName}...`);

				socket = io(serverUrl, {
					transports: ["websocket"],
					reconnection: true,
					reconnectionAttempts: 5,
					reconnectionDelay: 1000,
				});

				socket.on("connect", () => {
					isConnected = true;
					addLog("‚úÖ Connected to server");

					// Join as admin
					socket.emit("user:join", {
						name: adminName,
						deviceId: "admin_" + Date.now(),
						isAdmin: true,
					});

					document.getElementById("connectionForm").classList.add("hidden");
					document.getElementById("dashboard").classList.remove("hidden");
				});

				socket.on("disconnect", () => {
					isConnected = false;
					addLog("‚ùå Disconnected from server");
					document.getElementById("connectionForm").classList.remove("hidden");
					document.getElementById("dashboard").classList.add("hidden");
					connectBtn.disabled = false;
					connectBtn.textContent = "Connect as Admin";
				});

				socket.on("connect_error", (error) => {
					addLog("‚ùå Connection failed: " + error.message);
					connectBtn.disabled = false;
					connectBtn.textContent = "Connect as Admin";
				});

				// Admin events
				socket.on("admin:promoted", () => {
					addLog("üëë You are now an admin");
				});

				socket.on("queue:new:request", (data) => {
					addLog(`üé§ ${data.userName} requested to speak`);
					updateQueue();
				});

				socket.on("queue:updated", (data) => {
					queue = data.queue;
					updateQueue();
					updateStats();
				});

				socket.on("user:list:updated", (userList) => {
					users.clear();
					userList.forEach((user) => {
						users.set(user.id, user);
					});
					updateUsersList();
					updateStats();
				});

				socket.on("speaker:started", (data) => {
					addLog(`üó£Ô∏è ${data.speakerName} started speaking`);
					const user = users.get(data.speakerId);
					if (user) {
						user.isSpeaking = true;
						speakers.set(data.speakerId, user);
					}
					updateSpeakersList();
					updateUsersList();
					updateStats();
				});

				socket.on("speaker:stopped", (data) => {
					addLog(`üîá ${data.speakerName} stopped speaking`);
					speakers.delete(data.speakerId);
					const user = users.get(data.speakerId);
					if (user) {
						user.isSpeaking = false;
					}
					updateSpeakersList();
					updateUsersList();
					updateStats();
				});

				socket.on("stats:response", (stats) => {
					updatePerformanceMetrics(stats);
				});

				// Request stats every 5 seconds
				setInterval(() => {
					if (socket && socket.connected) {
						socket.emit("stats:request");
					}
				}, 5000);
			}

			function approveToSpeak(userId) {
				if (socket) {
					socket.emit("admin:approve:speak", { userId });
					addLog(`‚úÖ Approved user to speak`);
				}
			}

			function rejectToSpeak(userId) {
				if (socket) {
					socket.emit("admin:reject:speak", { userId });
					addLog(`‚ùå Rejected user's speaking request`);
				}
			}

			function stopSpeaking(userId) {
				if (socket) {
					socket.emit("admin:stop:speaking", { userId });
					addLog(`‚èπÔ∏è Stopped user from speaking`);
				}
			}

			function updateQueue() {
				const queueList = document.getElementById("queueList");

				if (queue.length === 0) {
					queueList.innerHTML =
						'<div class="empty-state">No pending requests</div>';
					return;
				}

				queueList.innerHTML = queue
					.map(
						(item, index) => `
                <div class="queue-item">
                    <div class="queue-info">
                        <div class="queue-name">#${index + 1} - ${
							item.name
						}</div>
                        <div class="queue-time">Requested: ${new Date(
													item.requestTime
												).toLocaleTimeString()}</div>
                    </div>
                    <div class="queue-actions">
                        <button class="btn btn-approve" onclick="approveToSpeak('${
													item.id
												}')">‚úÖ Approve</button>
                        <button class="btn btn-reject" onclick="rejectToSpeak('${
													item.id
												}')">‚ùå Reject</button>
                    </div>
                </div>
            `
					)
					.join("");
			}

			function updateSpeakersList() {
				const speakersList = document.getElementById("speakersList");

				if (speakers.size === 0) {
					speakersList.innerHTML =
						'<div class="empty-state">No one is speaking</div>';
					return;
				}

				speakersList.innerHTML = Array.from(speakers.values())
					.map(
						(speaker) => `
                <div class="user-item speaker-item">
                    <div class="user-info">
                        <div class="user-name">üé§ ${speaker.name}</div>
                        <div class="user-status">Speaking now</div>
                    </div>
                    <button class="btn btn-stop" onclick="stopSpeaking('${speaker.id}')">‚èπÔ∏è Stop</button>
                </div>
            `
					)
					.join("");
			}

			function updateUsersList() {
				const usersList = document.getElementById("usersList");

				if (users.size === 0) {
					usersList.innerHTML =
						'<div class="empty-state">No users connected</div>';
					return;
				}

				usersList.innerHTML = Array.from(users.values())
					.map(
						(user) => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-name">
                            <span class="status-indicator ${
															user.isSpeaking
																? "status-connected"
																: "status-disconnected"
														}"></span>
                            ${user.name} ${user.isAdmin ? "üëë" : ""}
                        </div>
                        <div class="user-status">
                            ${user.isSpeaking ? "Speaking" : "Listening"} ‚Ä¢ 
                            Joined: ${new Date(
															user.joinTime
														).toLocaleTimeString()}
                        </div>
                    </div>
                </div>
            `
					)
					.join("");
			}

			function updateStats() {
				document.getElementById("totalUsers").textContent = users.size;
				document.getElementById("activeSpeakers").textContent = speakers.size;
				document.getElementById("queueLength").textContent = queue.length;
			}

			function updatePerformanceMetrics(stats) {
				document.getElementById("packetsProcessed").textContent =
					stats.totalPacketsProcessed || 0;
				document.getElementById("uptime").textContent =
					Math.floor(stats.uptime || 0) + "s";
				document.getElementById("avgLatency").textContent =
					Math.floor(stats.averageLatency || 0) + "ms";

				if (stats.memoryUsage) {
					const memoryMB = Math.floor(stats.memoryUsage.heapUsed / 1024 / 1024);
					document.getElementById("memoryUsage").textContent = memoryMB + "MB";
				}
			}

			// Auto-save server URL
			document.getElementById("serverUrl").addEventListener("input", (e) => {
				localStorage.setItem("adminServerUrl", e.target.value);
			});

			document.getElementById("adminName").addEventListener("input", (e) => {
				localStorage.setItem("adminName", e.target.value);
			});

			// Load saved values
			window.addEventListener("load", () => {
				const savedUrl = localStorage.getItem("adminServerUrl");
				const savedName = localStorage.getItem("adminName");

				if (savedUrl) {
					document.getElementById("serverUrl").value = savedUrl;
				}

				if (savedName) {
					document.getElementById("adminName").value = savedName;
				}
			});
		</script>
	</body>
</html>
